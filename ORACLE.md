
# Oracle 조사 쿼리(Simple)
LGChem의 Oracle 정보 조회 쿼리

## 1. Oracle ASIS조사 쿼리
ASIS Oracle 10.2.0.3 기준

* #### 1.1 인스턴스 조사
    ```sql
    SELECT * FROM V$INSTANCE;
    ```

* #### 1.2 DB 용량 확인
    ```sql
    SELECT sum(bytes)/1024/1024/1024 FROM dba_segments;
    ```

* #### 1.3 캐릭터셋 조사
    ```sql
    SELECT * FROM NLS_DATABASE_PARAMETERS;
    ```

* #### 1.4 국가 / 언어
    ```sql
    SELECT * FROM NLS_DATABASE_PARAMETERS;
    ```

* #### 1.5 Redo Log 일별 발생량
    ```sql
    SELECT
    SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH:MI:SS'),1,5) AS DAY
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'00',1,0)) AS H00
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'01',1,0)) AS H01
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'02',1,0)) AS H02
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'03',1,0)) AS H03
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'04',1,0)) AS H04
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'05',1,0)) AS H05
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'06',1,0)) AS H06
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'07',1,0)) AS H07
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'08',1,0)) AS H08
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'09',1,0)) AS H09
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'10',1,0)) AS H10
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'11',1,0)) AS H11
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'12',1,0)) AS H12
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'13',1,0)) AS H13
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'14',1,0)) AS H14
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'15',1,0)) AS H15
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'16',1,0)) AS H16
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'17',1,0)) AS H17
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'18',1,0)) AS H18
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'19',1,0)) AS H19
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'20',1,0)) AS H20
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'21',1,0)) AS H21
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'22',1,0)) AS H22
    ,SUM(DECODE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH24:MI:SS'),10,2),'23',1,0)) AS H23
    ,COUNT(*) AS TOTAL
    FROM v$log_history a
        WHERE (TO_DATE(SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH:MI:SS'), 1,8), 'MM/DD/RR') >= to_char(sysdate-18,'YYYYMMDD'))
        AND (TO_DATE(substr(TO_CHAR(first_time, 'MM/DD/RR HH:MI:SS'), 1,8), 'MM/DD/RR') <= to_char(sysdate-1,'YYYYMMDD'))
        GROUP BY SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH:MI:SS'),1,5)
        ORDER BY SUBSTR(TO_CHAR(first_time, 'MM/DD/RR HH:MI:SS'),1,5) DESC;
    ```

* #### 1.6 현재 세션 리스트 
    ```sql
    SELECT username,TYPE, MACHINE, OSUSER, PROGRAM, COUNT(*)
    FROM v$session
    WHERE TYPE NOT IN ('BACKGROUND') 
    GROUP BY username,TYPE, MACHINE, OSUSER, PROGRAM;
    ```

* #### 1.7 계정별 오브젝트 갯수 
    ```sql
    SELECT owner, object_type, count(*) CNT
    FROM dba_objects 
    WHERE owner NOT IN ('OUTLN','MGMT_VIEW','SYS','SYSTEM','EXFSYS','WKSYS','XDB','SI_INFORMTN_SCHEMA','CTXSYS','ANONYMOUS','DMSYS','WK_TEST','WMSYS','ORDSYS','ORDPLUGINS','WKPROXY','MDSYS','SYSMAN','DBSNMP','TSMSYS','DIP','MDDATA','DEMO','AURORA$ORB$UNAUTHENTICATED','AWR_STAGE','CSMIG','DSSYS','LBACSYS','ORACLE_OCM','PERFSTAT','TRACESVR','OLAPSYS')
    GROUP BY owner, object_type
    ORDER BY owner,object_type;
    ```

* #### 1.8 계정 상태
    ```sql
    SELECT USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,PROFILE,ACCOUNT_STATUS,CREATED
    FROM DBA_USERS; 
    ```

* #### 1.9 계정별 세그먼트 용량 
    ```sql
    SELECT owner, sum(bytes)/1024/1024 
    FROM dba_segments
	GROUP BY owner;
    ```

* #### 1.10 INVALID 찾기
    ```sql
    SELECT OWNER, OBJECT_NAME, OBJECT_TYPE,  STATUS
    FROM DBA_OBJECTS
    WHERE owner NOT IN ('OUTLN','MGMT_VIEW','SYS','SYSTEM','EXFSYS','WKSYS','XDB','SI_INFORMTN_SCHEMA','CTXSYS','ANONYMOUS','DMSYS','WK_TEST','WMSYS','ORDSYS','ORDPLUGINS','WKPROXY','MDSYS','SYSMAN','DBSNMP','TSMSYS','DIP','MDDATA','DEMO','AURORA$ORB$UNAUTHENTICATED','AWR_STAGE','CSMIG','DSSYS','LBACSYS','ORACLE_OCM','PERFSTAT','TRACESVR','OLAPSYS')
    AND STATUS = 'INVALID';
    ```

* #### 1.11 테이블별 용량
    ```sql
    SELECT OWNER, TABLE_NAME, TABLESPACE_NAME
        ,SUM(NOMAL_COL)/1024/1024 NOMAL_COL_SIZE_MB
        ,SUM(LOB_COL)/1024/1024 LOB_COL_SIZE_MB
    FROM
    (
        SELECT A.OWNER, DECODE(A.SEGMENT_TYPE,'LOB',B.TABLE_NAME,A.SEGMENT_NAME) TABLE_NAME, A.SEGMENT_TYPE
            , A.TABLESPACE_NAME
            , DECODE(A.SEGMENT_TYPE,'LOB',0,A.BYTES) NOMAL_COL
            , DECODE(A.SEGMENT_TYPE,'LOB',A.BYTES,0) LOB_COL
        FROM DBA_SEGMENTS A
                , DBA_LOBS B 
        WHERE A.OWNER NOT IN ('OUTLN','MGMT_VIEW','SYS','SYSTEM','EXFSYS','WKSYS','XDB','SI_INFORMTN_SCHEMA','CTXSYS','ANONYMOUS','DMSYS','WK_TEST','WMSYS','ORDSYS','ORDPLUGINS','WKPROXY','MDSYS','SYSMAN','DBSNMP','TSMSYS','DIP','MDDATA','DEMO','AURORA$ORB$UNAUTHENTICATED','AWR_STAGE','CSMIG','DSSYS','LBACSYS','ORACLE_OCM','PERFSTAT','TRACESVR','OLAPSYS')
        AND A.SEGMENT_TYPE IN ('TABLE','LOB')
        AND A.OWNER = B.OWNER(+)
        AND A.SEGMENT_NAME = B.SEGMENT_NAME(+)
    )
    GROUP BY OWNER,TABLE_NAME,TABLESPACE_NAME;
    ```